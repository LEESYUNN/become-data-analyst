Wine Exploration Data Analysis
========================================================

I choose the white wine dataset to perform exploration data analysis. This dataset contains quality and chemical compositions for 4898 white wine. 

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using
# in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk.
# This prevents the code from displaying in the knitted HTML output.
# You should set echo=FALSE for all code chunks in your file.

library(ggplot2)
library(dplyr)
library(gridExtra)
library(car)
```

```{r echo=FALSE, Load_the_Data}
# Load the Data
wineData <- read.csv('wineQualityWhites.csv', na.strings = c('', 'NA'))

# create a new variable called bound.sulfur.dioxide according to wineQualityInfo.txt
wineData$bound.sulfur.dioxide <- wineData$total.sulfur.dioxide - wineData$free.sulfur.dioxide

# select and rearrange variables
wineData <- select(wineData, quality, fixed.acidity, volatile.acidity, citric.acid, residual.sugar, chlorides, free.sulfur.dioxide, bound.sulfur.dioxide, sulphates, density, pH, alcohol)
```
# Univariate Plots Section
```{r echo=FALSE, Univariate_Plots}
dim(wineData)
```

```{r echo=FALSE, Univariate_Plots}
str(wineData)
```

```{r echo=FALSE, Univariate_Plots}
summary(wineData)
```
The dataset contains 12 variables and almost 5000 observations. No NAs existed.

```{r echo=FALSE, Univariate_Plots}
# histogram of quality scores
ggplot(data=wineData, aes(x=quality)) + geom_bar()
```
```{r echo=FALSE, Univariate_Plots}
table(wineData$quality)
```
```{r echo=FALSE, Univariate_Plots}
summary(wineData$quality)
```
The lowest quality is 3 and the highest is 9; mean 5.878 and median 6. Most of the wine is in quality 5, 6 and 7. Wine with very high or low quality is rare.

```{r echo=FALSE, Univariate_Plots}
# histogram of fixed acidity
pOrigin <- ggplot(data=wineData, aes(x=fixed.acidity)) + geom_histogram()
pBinned <- ggplot(data=wineData, aes(x=fixed.acidity)) + geom_histogram(binwidth = 0.12)
grid.arrange(pOrigin, pBinned, ncol=1)
```
```{r echo=FALSE, Univariate_Plots}
summary(wineData$fixed.acidity)
```
Most wines have fixed acidity between 6 and 7.5 $g/dm^3$. There is a peak around 7 $g/dm^3$. Mean 6.855 $g/dm^3$ and median 6.80 $g/dm^3$; the maximum is 14.2 $g/dm^3$ and the minimum is 3.8 $g/dm^3$.

```{r echo=FALSE, Univariate_Plots}
# histogram of volatile acidity
ggplot(data=wineData, aes(x=volatile.acidity)) + geom_histogram(binwidth = 0.01)
```
```{r echo=FALSE, Univariate_Plots}
summary(wineData$volatile.acidity)
```
Most wines have volatile acidity between 0.15 and 0.31 $g/dm^3$ approximately. The mininum value is not much less than the maxinum. A high level of this value may lead to an unpleasant taste, I will analyze it with quality later on.

```{r echo=FALSE, Univariate_Plots}
# histogram of citric acidity
ggplot(data=wineData, aes(x=citric.acid)) + geom_histogram(binwidth = 0.01)
```
```{r echo=FALSE, Univariate_Plots}
summary(wineData$citric.acid)
```
Most wines have a citric acidity between 0.25 and 0.5 $g/dm^3$. The minimum value is 0.0, contains no citric acid, but this can add freshness and flavor to wines, later on I will also analyze the relation ship between citric acid and quality.

```{r echo=FALSE, Univariate_Plots}
# histogram of residual sugar
pSugarHist <- ggplot(data=wineData, aes(x=residual.sugar)) + geom_histogram(binwidth = 0.1)
pSugarHistScaled <- ggplot(data=wineData, aes(x=residual.sugar)) + geom_histogram(binwidth = 0.01) + scale_x_log10()
grid.arrange(pSugarHist, pSugarHistScaled, ncol=1)
```

```{r echo=FALSE, Univariate_Plots}
# boxplot of residual sugar
ggplot(data=wineData, aes(x='residual sugar', y=residual.sugar)) + geom_boxplot()
```

```{r echo=FALSE, Univariate_Plots}
summary(wineData$residual.sugar)
```
The residual sugar contributes to the sweetness of wine. I create an original histogram and a log-tranformed one to better analyze it. The transformed distribution appears bimodal with the residual sugar peaking at both 3 and 9 $g/dm^3$. Most of the wines contains residual sugar less than 10 $g/dm^3$, but some outliers exist. The boxplot indicates that median is around 5 and outliers have residual sugar more than 20 $g/dm^3$, some even has  more than 60 $g/dm^3$, that's too sweet. According to [Wikipedia](https://en.wikipedia.org/wiki/Sweetness_of_wine#Residual_sugar), a wine can be classified as four levels: dry(up to 4 $g/dm^3$), medium dry(up to 12 $g/dm^3$), medium(up to 45 $g/dm^3$) and sweet(more than 45 $g/dm^3$) by sweetness, I wonder what the plot looks like across these categories.

```{r echo=FALSE, Univariate_Plots}
table(cut(wineData$residual.sugar, breaks = c(-Inf, 4, 12, 45, Inf)))
```

```{r echo=FALSE, Univariate_Plots}
ggplot(data=wineData, aes(x=cut(wineData$residual.sugar, breaks = c(-Inf, 4, 12, 45, Inf)))) + 
  geom_bar() + 
  scale_x_discrete(labels = c('dry', 'medium dry', 'medium', 'sweet'))
```

Most of wines are dry or medium dry, there are 825 wines of medium, and only 1 wine is sweet. And I'd like to have a look at the quality distributions of each level.
```{r echo=FALSE, Univariate_Plots}
pQualityDry <- ggplot(data=subset(wineData, residual.sugar <= 4), aes(x=quality)) + geom_histogram() + labs(title='dry')
pQualityMediumDry <- ggplot(data=subset(wineData, residual.sugar > 4 & residual.sugar <= 12), aes(x=quality)) + geom_histogram() + labs(title='medium dry')
pQualityMeidum <- ggplot(data=subset(wineData, residual.sugar > 12 & residual.sugar <= 45), aes(x=quality)) + geom_histogram() + labs(title='medium')
pQualitySweet <- ggplot(data=subset(wineData, residual.sugar > 45), aes(x=quality)) + geom_histogram() + labs(title='sweet')
grid.arrange(pQualityDry, pQualityMediumDry, pQualityMeidum, pQualitySweet, ncol=2)
```
Level of sweet wine has quality 6, and other levels have wines of greater quality, in bivariate analysis section I will analyze the relationship between sugar and quality deeply.
```{r echo=FALSE, Univariate_Plots}
# histogram of chlorides
ggplot(data=wineData, aes(x=chlorides)) + geom_histogram(binwidth = 0.001)
```
```{r echo=FALSE, Univariate_Plots}
# boxplot of chlorides
ggplot(data=wineData, aes(x='chlorides', y=chlorides)) + geom_boxplot()
```
```{r echo=FALSE, Univariate_Plots}
summary(wineData$chlorides)
```
Most wines have chlorides between 0.025 and 0.0755 $g/dm^3$, this is the amount of salt in wine. The boxplot indicates that there are many outliers existed, the maximum value is 0.346 $g/dm^3$, but the variation in chlorides is small. Will a too-salty wine tastes bad? I will exlore it with quality later on.

```{r echo=FALSE, Univariate_Plots}
# histogram of free sulfur dioxide
ggplot(data=wineData, aes(x=free.sulfur.dioxide)) + geom_histogram(binwidth = 1)
```

```{r echo=FALSE, Univariate_Plots}
# histogram of bound sulfur dioxide
ggplot(data=wineData, aes(x=bound.sulfur.dioxide)) + geom_histogram(binwidth = 1)
```

```{r echo=FALSE, Univariate_Plots}
# histogram of sulphates
ggplot(data=wineData, aes(x=sulphates)) + geom_histogram(binwidth = 0.01)
```
```{r echo=FALSE, Univariate_Plots}
summary(select(wineData, free.sulfur.dioxide, bound.sulfur.dioxide, sulphates))
```
Sulfur dioxide can prevent microbial growth and oxidation of wine. But it is somewhat harmful so the amount has to be limited. Most wines have free sulfur dioxide below 50 $mg/dm^3$, and bound sulfur dioxide one between 50 and 150 $mg/dm^3$. The maximum values of free and bound sulfur dioxide is 289 and 331 respectively, maybe this is a factor that affects the quality. Sulphates is an additive that can keep sulfur dioxide levels, most wines have between 0.4 and 0.6 $g/dm^3$.

```{r echo=FALSE, Univariate_Plots}
# histogram of density
ggplot(data=wineData, aes(x=density)) + geom_histogram(binwidth = 0.0001)
```
```{r echo=FALSE, Univariate_Plots}
summary(wineData$density)
```
Most wine has a density around 1.00 $g/cm^3$.

```{r echo=FALSE, Univariate_Plots}
# histogram of pH
ggplot(data=wineData, aes(x=pH)) + geom_histogram(binwidth = 0.01)
```
```{r echo=FALSE, Univariate_Plots}
summary(wineData$pH)
```
All the wine is naturally acidic. And most of them are in pH 3.0-3.3; minimum 2.72, maximum 3.82, mean and median are almost the same. This may correlates to acidities above.

```{r echo=FALSE, Univariate_Plots}
# histograms of alcohol
ggplot(data=wineData, aes(x=alcohol)) + geom_histogram(binwidth = 0.1)
```
```{r echo=FALSE, Univariate_Plots}
# histograms of alcohol
ggplot(data=wineData, aes(x=alcohol)) + geom_histogram(binwidth = 0.01)
```
```{r echo=FALSE, Univariate_Plots}
summary(wineData$alcohol)
```
Wine is a kind of low-alcohol drink. Most of them have alcohol between 9% and 12%. The minimum is 8% and the maximum is 14.2%, mean and median are 10.4% and 10.51% respectively. I guess alcohol is one of the important factors that will affect the quality.

# Univariate Analysis

### What is the structure of your dataset?

There are 4898 wines with 12 variables (quality, fixed acidity, volatile acidity, citric acid, residual sugar, chlorides, free and total sulfur dioxide, sulphates, density, pH and alcohol). All are numeric. 

Other observations:

* Most wines are of quality 5, 6 and 7;
* The median quality is 6;
* Most wines have fixed acidity between 6 and 7.5 $g/dm^3$;
* Most wines have volatile acidity between 0.15 and 0.31 $g/dm^3$;
* Most wines have citric acid between 0.25 and 0.5 $g/dm^3$;
* Most wines have residual sugar less than 10 $g/dm^3$;
* The number of wines of "dry", "medium dry", "medium" and "sweet" are 2097, 1975, 825 and 1 respectively;
* Most wines have chlorides between 0.025 and 0.0755 $g/dm^3$, but many outliers existed;
* Most wines have free sulfur dioxide below 50 $mg/dm^3$ and bound sulfur dioxide 50-150 $mg/dm^3$, a 0.4-0.6 $g/dm^3$ sulphates keep their levels;
* Most wines are naturally acidic, around 3.0-3.3;
* Most wines' alcohol is low, about 9%-12%.

### What is/are the main feature(s) of interest in your dataset?
Quality is the main feature of interest in my dataset. I want to figure out how these chemical compositions affect the quality of wine. Maybe there are some features best for predicting the quality of wine.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?
Fixed acidity, volatile acidity, citric acid, residual sugar, chlorides, sulfur dioxide, sulphates and alcohol are likely to contribute to quality of wines. 
### Did you create any new variables from existing variables in the dataset?
Yes, I create a new variable "bound.sulfur.dioxide" to divide total sulfur dioxide into two parts: the free one and the bound one, thus investigate them apartly in following explorations.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?
Yes, the histogram of residual sugar is highly right-skewed, this makes it difficult to analyze. So I create a log-transformed histogram to better investigate it. The transformed distribution appears bimodal with the residual sugar peaking at both 3 and 9 $g/dm^3$.


# Bivariate Plots Section
```{r echo=FALSE, Bivariate_Plots}
options(digits = 1)
cor(wineData)
```

```{r echo=FALSE, warning=FALSE, Bivariate_Plots, fig.width=10}
scatterplotMatrix(~ quality + fixed.acidity + residual.sugar + chlorides + free.sulfur.dioxide + bound.sulfur.dioxide + density + pH + alcohol, data = wineData, spread = FALSE, smoother.args=list(lty=2), main='Scatter plot matrix of wine')
```
Some variables correlate with each other. Residual sugar correlates strongly with density, so is alchohol. All meaningful correlations are:

* quality: density(-0.307), alcohol(0.436)
* fixed acidity: pH(-0.43)
* residual sugar: free sulfur dioxide(0.30), bound sulfur.dioxide(0.34), density(0.84), alcohol(-0.45)
* chlorides: alcohol(-0.36)
* density: bound sulfur dioxide(0.50), alcohol(-0.78)
* alcohol: bound sulfur dioxide(-0.43)

Density and alcohol correlate with quality. I'd like to take a look at scatter plot involving them first.
```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=density, y=quality)) + geom_point()
```
```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=density, y=quality)) + 
  geom_jitter(alpha=0.02) + 
  scale_x_continuous(limits = c(0.95, 1.05)) + 
  geom_smooth(color='red', se=FALSE, method='lm')
```
The horizontal lines indicate quality values are all integers. After adding jitter, transparency, lineary smooth and changing the y limits, it shows a slight correlation between density and quality.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=alcohol, y=quality)) + geom_point()
```
```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=alcohol, y=quality)) + 
  geom_jitter(alpha=0.05) + 
  geom_smooth(se=FALSE, method='lm', color='red')
```
Similarly, After adding jitter, transparency and linear smooth, it shows a slight correlation between alcohol and quality. Next I'll investigate alcohol across different qualities.
```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=factor(quality, ordered = TRUE), y=alcohol)) + 
  geom_boxplot() +
  xlab('qualities')
```
```{r echo=FALSE, Bivariate_Plots}
by(wineData$alcohol, factor(wineData$quality, ordered=TRUE), summary)
```

Wines of higher quality(6, 7 and 8) tends to have bigger median and variation in alcohol than those of lower quality(3, 4 and 5). And wines of best quality have the highest median and smallest variation. Outliers occur most in quality of 5.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=fixed.acidity, y=pH)) + geom_point()
```
```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=fixed.acidity, y=pH)) + geom_jitter(alpha=0.05) + geom_smooth(method='lm', color='red', se=FALSE)
```
It is not surprising that fixed acidity correlates with pH, and after dealing with overplotting by adding jitter and alpha, the plot shows a meaningful-but-small correlation between them. The higher the fixed acidity, the lower the pH (more acid). So again let's take a look at fixed acidity across qualities.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=factor(quality, ordered = TRUE), y=fixed.acidity)) + 
  geom_boxplot() +
  xlab('qualities')
```
As the quality improves, median of fixed acidity tends to decrease a little bit and increase from quality of 8 on. On the other hand, the variation tends to decrease, and at the best quality of 9, the variation is very small. Outliers appear more in low qualities.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=factor(quality, ordered = TRUE), y=volatile.acidity)) + 
  geom_boxplot() +
  xlab('qualities')
```
A too high of levels of volatile acidity could lead to unpleasant taste, and this is proven by the outliers in plot. More outliers appear in quality less than or equal to 6. And variation in volatile acidity of high-quality wines tends to be smaller than low-quality ones. Wines of best quality have no outliers and the median is close to Q1 value.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=factor(quality, ordered = TRUE), y=citric.acid)) + 
  geom_boxplot() +
  xlab('qualities')
```
Citric acid is yet another factor that may affect taste, it add freshness and falvor to wines. From the plot we can see that although citric acid may improve taste, but it is not that "the more the better", adding quite a lot will not help, which can be seen by the many outliers in quality of 6. On the other hand, the median, minimum and maximum value of best quality are actually higher than other qualities.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=factor(wineData$quality, ordered=TRUE), y=pH)) + geom_boxplot() + xlab('qualities')
```

Variation in pH decreases a lot and then increases slightly, and at the best quality it decreases to the minimum. What is interesting is that wines of best quality tend to have a median which is equal to the Q1.

Although they show no correlation with quality, but I still want to investigate what free and bound sulfur dioxide look like across qualities. 
```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=factor(wineData$quality, ordered=TRUE), y=free.sulfur.dioxide)) + geom_boxplot() + xlab('qualities')
```

```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=factor(wineData$quality, ordered=TRUE), y=bound.sulfur.dioxide)) + geom_boxplot() + xlab('qualities')
```
Both free and bound sulfur dioxide tend to have the same pattern. The median decreases slightly when quality improves, and the variation becomes smaller and smaller. High quality tends to have less outliers. One of the obvious difference is that the median and variation in free sulfur dioxide is much smaller than the one in bound sulfur dioxide, comparing under the same quality.

Next I'll consider about residual sugar. It is the amount of sugar remaining after fermentaion stops. At the very beginning I thought it might correlate with alcohol strongly but what is surprising is that it correlates with density most strongly.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=residual.sugar, y=density)) + geom_jitter(alpha=0.05) + geom_smooth(method='lm', color='red')
```

```{r echo=FALSE, Bivariate_Plots}
summary(lm(formula=density ~ residual.sugar, data=wineData))
```

Although the plot looks quite linear, what we can infer from the $R^2$ value is that residual sugar only explains about 70.4% of the variance in density. I am not very content with this value, by checking the correlation matrix again, I find that density correlates with bound sulfur dioxide moderately and alcohol strongly, so is it possible to build a better model among them all? Let's try this!

```{r echo=FALSE, Bivariate_Plots}
m1 <- lm(formula=density ~ residual.sugar, data=wineData)
m2 <- update(m1, ~ . + bound.sulfur.dioxide)
m3 <- update(m2, ~ . + alcohol)
summary(m3)
```
And yes! The $R^2$ improves to 0.914, which means that residual sugar, together with bound sulfur dioxide and alcohol, explains 91.4% of the variance in density. Now it's time to analyze residual sugar across qualities.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=factor(wineData$quality, ordered=TRUE), y=residual.sugar)) + geom_boxplot() + xlab('qualities')
```
The variance in residual sugar goes with its median. As the quality improves, the variation and median decrease and then increase, and again decrease till quality of 7 and then increase at 8, and at the quality of 9 both decrease: the variation decreases to the mininum and median decreases to the first quantile.

```{r echo=FALSE, Bivariate_Plots}
ggplot(data=wineData, aes(x=factor(wineData$quality, ordered=TRUE), y=chlorides)) + geom_boxplot() + xlab('qualities')
```
Then comes the chlorides across qualities. There are some interesting things in plot. Firstly, there are more outliers in quality of 5 and 6 than the others; secondly, the variation remains small and the median doesn't change very much; thirdly, the quality of 9 has the smallest variation and the median is equal to Q3 approximately.

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

Density correlates with residual sugar and alcohol strongly.

Quality's correlations with density and alcohol are both very small. Wines of higher quality(6, 7 and 8) tend to have bigger median and variation in alcohol than those of lower quality(3, 4 and 5). And wines of best quality have the highest median and smallest variation. Outliers occur most in quality of 5.

Fixed acidity has a meaningful-but-small correlation with pH, about -0.43. Wines of best quality have a relatively higher citric acid than others but no outliers.

For all the chemicals analyzed(acidities, alcohol, pH, sulfur dioxide, residual sugar and chlorides), wines of best quality show two common pattern:

1. The variation tends to be small;
2. There's only one or even no outliers;

Based on the $R^2$ value, if incorporated with feature of bound sulfur dioxide and alcohol, residual sugar explains abount 91.4% of the variance in density.

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

Fixed acidity tends to correlate with pH value. The higher the fixed acidity, the lower the pH value.

### What was the strongest relationship you found?

The residual sugar is positively and strongly correlated with density; alcohol is negatively correlates with density but less strongly. And if we want a better linear regression model between residual sugar and density, we must incorporate with bound sulfur dioxide and alcohol, and this gives a $R^2$ of 91.4%.



# Multivariate Plots Section

```{r echo=FALSE, Multivariate_Plots}

```

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

### Were there any interesting or surprising interactions between features?

### OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}

```

### Description One


### Plot Two
```{r echo=FALSE, Plot_Two}

```

### Description Two


### Plot Three
```{r echo=FALSE, Plot_Three}

```

### Description Three

------

# Reflection
